function main(){console.log("Loaded...");var e=new Table;document.body.appendChild(e.table)}function def(e){return"undefined"!=typeof e&&null!==e}function cr(e,t,n){if(!e)return null;var r=document.createElement(e);return def(t)&&(r.className=t),def(n)&&n.appendChild(r),r}function loadJson(e,t){var n=cr("script");n.onload=t,n.src=e,document.body.appendChild(n)}function iterToStr(e){var t=[String.fromCharCode(65+e%26)];for(e=Math.floor(e/26);e>0;)t.splice(0,0,String.fromCharCode(64+e%26)),e=Math.floor(e/26);return t.join("")}function getIterNum(){return iter.num+=1}function getIterLit(){return iterToStr(iter.lit+=1)}document.body.onload=function(){loadJson("config.json",main)},window.cell={},window.currentcell=null,window.Cell=function(){function e(e){e.dependants=[],e.links=[],e.dom=cr("td"),e.input=e.dom.cr("input","hidden"),e.view=e.dom.cr("div"),e.view.addEventListener("mousedown",function(e){def(window.currentcell)&&e.preventDefault()}),e.view.addEventListener("click",function(t){def(window.currentcell)?(t.preventDefault(),window.currentcell.input.value+=e.address[1]+e.address[0]):(e.input.classList.remove("hidden"),e.input.focus(),window.currentcell=e)},!0),e.input.onkeyup=function(e){13==e.keyCode&&this.blur()},e.input.onblur=function(){e.input.classList.add("hidden"),e.valueToView(!0),window.currentcell=null}}function t(){for(var e=this,t=0;t<e.links.length;t++){var n=e.links[t];cell[n[0]][n[1]].dependants.remove(e.address)}e.links=[];var r=e.input.value||"";if("="==r[0]){r=r.slice(1),r=r.replace(/([a-zA-Z]+\d+)/g,function(t,n){var r=n.indexOf(/\d/),i=[n.slice(r),n.slice(0,r).toUpperCase()];e.links.add(i);var o=cell[i[0]][i[1]].view.textContent;return o});for(var t=0;t<e.links.length;t++){var n=e.links[t];cell[n[0]][n[1]].dependants.push(e.address)}try{r=math.eval(r)}catch(i){r="!EXPR"}}this.view.textContent=r;for(var t=0;t<e.dependants.length;t++){var n=e.dependants[t];cell[n[0]][n[1]].autofetch()}}function n(){var e=this.input.value||"";if("="==e[0]){e=e.slice(1),e=e.replace(/([a-zA-Z]+\d+)/g,function(e,t){var n=t.indexOf(/\d/),r=[t.slice(n),t.slice(0,n).toUpperCase()],i=cell[r[0]][r[1]].view.textContent;return i});try{e=math.eval(e)}catch(t){e="!EXPR"}}this.view.textContent=e;for(var n=0;n<this.dependants.length;n++){var r=this.dependants[n];cell[r[0]][r[1]].autofetch()}}return function(){e(this),this.valueToView=t,this.autofetch=n}}(),window.Table=function(){function e(e,t,n){var r=t.cr("tr");r.cols=[],window.cell[n]={};var i=r.cr("td","heading");r.heading=i;for(var o=0;o<config.table.cols;o++){var l=new Cell;r.appendChild(l.dom),r.cols.push(l.dom),l.address=[n,e.liters[o]],window.cell[n][e.liters[o]]=l}return r}function t(t){t.table=cr("table"),t.thead=t.table.cr("thead"),t.tbody=t.table.cr("tbody"),t.liters=[];for(var n=e(t,t.thead),r=0;r<config.table.cols;r++){var i=getIterLit();t.liters.push(i),n.cols[r].textContent=i}for(var r=0;r<config.table.rows;r++){var o=getIterNum(),l=e(t,t.tbody,o);l.heading.textContent=o}}return function(){t(this)}}(),Node.prototype.cr=function(e,t){return cr(e,t,this)},Array.prototype.add=function(e){var t=this.indexOf(e);return-1==t?(this.push(e),this.length):!1},Array.prototype.remove=function(e){var t=this.indexOf(e);return-1!=t?(this.splice(t,1),this.length):!1},window.iter={num:0,lit:-1};